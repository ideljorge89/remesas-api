{% extends "@FOSUser/layout_backend.html.twig" %}
{% trans_default_domain 'FOSUserBundle' %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/backend/js/plugins/cropper/crop-avatar/css/main.css') }}"/>
    <link href="{{ asset('assets/backend/css/plugins/cropper/cropper.min.css') }}" rel="stylesheet">
    {{ parent() }}

{% endblock %}
{% block breadcrumb %}
    <div class="col-lg-12">
        <h2>{{ 'profile.show.pages_edit_profile'|trans({},'FOSUserBundle') }}</h2>
        <ol class="breadcrumb">
            <li>
                <a href="{{ path('fos_user_profile_edit') }}">{{ 'profile.show.extra_pages'|trans({},'FOSUserBundle') }}</a>
            </li>
            <li class="active">
                <strong>{{ 'profile.show.pages_edit_profile'|trans({},'FOSUserBundle') }}</strong>
            </li>
        </ol>
    </div>
{% endblock %}
{% block fos_user_content %}
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>{{ 'profile.edit.edit_title'|trans({'%name%':app.user.username}) }}
                        <small></small>
                    </h5>
                </div>
                <div class="ibox-content">
                    <form id="{{ form.vars.id }}" class="form-horizontal"
                          action="{{ path('fos_user_profile_edit') }}" method="POST"
                          class="fos_user_profile_edit">
                        <div class="row">
                            <div class="pull-left col-sm-4">
                                {{ include('@FOSUser/Profile/edit_avatar.html.twig',{'form':form}) }}
                            </div>
                            <div class="pull-right col-sm-8">

                                {{ form_row(form._token) }}
                                {% if form_errors(form) %}
                                    <div class="alert-danger" role="alert">
                                        <span class="fa fa-exclamation" aria-hidden="true"></span>
                                        <span class="sr-only">Error:</span>
                                        {{ form_errors(form) | striptags }}
                                    </div>
                                {% endif %}
                                <fieldset>
                                    <div class="form-group required">
                                        <label class="col-md-4 control-label">{{ form_label(form.email) | striptags }}
                                            <sup>*</sup></label>

                                        <div class="col-md-6">
                                            {{ form_widget(form.email, { 'attr': {'class': 'form-control'} }) }}
                                            {% if form_errors(form.email) %}
                                                <div class="alert-danger" role="alert">
                                                <span class="fa fa-exclamation"
                                                      aria-hidden="true"></span>
                                                    <span class="sr-only">Error:</span>
                                                    {{ form_errors(form.email) | striptags }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% if not is_granted("ROLE_DISTRIBUIDOR") %}
                                        <div class="form-group required">
                                            <label class="col-md-4 control-label">{{ form_label(form.porcentaje) | striptags }}
                                                <sup>*</sup></label>

                                            <div class="col-md-6">
                                                {{ form_widget(form.porcentaje, { 'attr': {'class': 'form-control'} }) }}
                                                {% if form_errors(form.porcentaje) %}
                                                    <div class="alert-danger" role="alert">
                                                <span class="fa fa-exclamation"
                                                      aria-hidden="true"></span>
                                                        <span class="sr-only">Error:</span>
                                                        {{ form_errors(form.porcentaje) | striptags }}
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endif %}
                                    {% if is_granted("ROLE_AGENCIA") or is_granted("ROLE_AGENTE") %}
                                        <div class="form-group required">
                                            <label class="col-md-4 control-label">CÃ¡lculo x porciento<sup>*</sup></label>
                                            <div class="col-md-6">
                                                {{ form_widget(form.auth,{'attr':{'class':'form-control js-switch'}}) }}
                                            </div>
                                        </div>
                                    {% endif %}
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"></label>

                                        <div class="col-md-8">
                                            <div style="clear:both"></div>
                                            <input type="submit" class="btn btn-primary"
                                                   value="{{ 'profile.edit.submit'|trans }}"/>
                                        </div>
                                    </div>
                                </fieldset>

                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade " id="avatar-modal-{{ form.filePath.vars.id }}" aria-hidden="true"
         aria-labelledby="avatar-modal-label"
         role="dialog" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal" type="button">&times;</button>
                    <h4 class="modal-title"
                        id="avatar-modal-label">{{ 'backend.tabs_traduccion.change_photo'|trans({},'AppBundle') }}</h4>
                </div>
                <div class="modal-body">
                    <div class="avatar-body">
                        <form class="avatar-form avatar-form-{{ form.filePath.vars.id }}"
                              action="{{ url('app_photo_crop',{'avatar':true}) }}" enctype="multipart/form-data"
                              method="post">

                            <!-- Upload image and data -->
                            <div class="avatar-upload" style="margin-bottom: -30px;">
                                <input class="avatar-src" name="avatar_src" type="hidden">
                                <input class="avatar-data" name="avatar_data" type="hidden">
                                <div class="input">
                                    <input class="avatar-input" accept="image/*"
                                           id="avatarInput{{ form.filePath.vars.id }}"
                                           name="avatar_file" type="file"
                                           style="width:180.5px;background-color: #ab0058;border-radius: 5px;height: 30px;padding-top: 40px;cursor:pointer;margin-left:15px;">
                                    <label for="avatarInput{{ form.filePath.vars.id }}"
                                           style="width:180.5px;color: white;margin-left: 30px;position: relative;top: -30px;">{{ 'backend.tabs_traduccion.select_photo'|trans({},'AppBundle') }}</label>
                                </div>

                            </div>

                            <!-- Crop and preview -->
                            <div class="row">
                                <div class="col-md-9">
                                    <div class="avatar-wrapper"></div>
                                </div>
                                <div class="col-md-3">
                                    <div class="avatar-preview preview-lg"></div>
                                    <div class="avatar-preview preview-md" style="border-radius: 50%;"></div>
                                    <div class="avatar-preview preview-sm"></div>
                                </div>
                            </div>
                            <div class="row avatar-btns">
                                <div class="col-md-10">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="-90"
                                                title="Rotate -90 degrees">{{ 'backend.tabs_traduccion.rotate_photo_left'|trans({},'AppBundle') }}</button>
                                        <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="-15">-15deg
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="-30">-30deg
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="-45">-45deg
                                        </button>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="90"
                                                title="Rotate 90 degrees">{{ 'backend.tabs_traduccion.rotate_photo_right'|trans({},'AppBundle') }}</button>
                                        <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="15">15deg
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="30">30deg
                                        </button>
                                        <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="45">45deg
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-primary btn-block avatar-save" type="submit">
                                        <i class="fa fa-save"></i> {{ 'backend.tabs_traduccion.accept'|trans({},'AppBundle') }}
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock fos_user_content %}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('assets/backend/js/plugins/validate/jquery.validate.min.js') }}"></script>
    <script src="{{ asset('assets/backend/js/plugins/validate/messages_es.js') }}"></script>

    <script src="{{ asset('assets/backend/js/plugins/cropper/cropper.js') }}"></script>
    <script src="{{ asset('assets/backend/js/plugins/cropper/jquery-cropper.js') }}"></script>
    <script type="application/javascript"
            src="{{ asset('assets/backend/js/plugins/cropper/crop-avatar/js/main.js') }}"></script>
    <script>
        $(function () {
            $(document).ready(function () {
                $("#{{ form.vars.id }}").validate({
                    rules: {
                        "{{ form.email.vars.full_name }}": {
                            required: true,
                            email: true,

                        },
                        {% if not is_granted("ROLE_DISTRIBUIDOR") %}
                        '{{ form.porcentaje.vars.full_name }}': {
                            required: true,
                            number: true,
                            minlength: 1,
                            maxlength: 5,
                            min: 1,
                            max: 99
                        },
                        {% endif %}
                    }
                });
            });

            if (typeof $ != "undefined") {
                return new $.fn.CropAvatar($('#crop-avatar{{ form.filePath.vars.id }}'), 1);
            }
        });

    </script>
{% endblock %}
