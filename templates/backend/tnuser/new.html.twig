{% extends 'base_backend.html.twig' %}
{% trans_default_domain 'AppBundle' %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/backend/js/plugins/cropper/crop-avatar/css/main.css') }}"/>
    <link href="{{ asset('assets/backend/css/plugins/cropper/cropper.min.css') }}" rel="stylesheet">
    {{ parent() }}

{% endblock %}
{% block breadcrumb %}
    <div class="col-lg-12">
        <h2>{{ 'backend.user_menu.administrator.users.add'|trans({},'FOSUserBundle') }}</h2>
        <ol class="breadcrumb">
            <li>
                <a href="{{ path('homepage_backend') }}"><i
                            class="fa fa-home"></i> {{ 'backend.user_menu.admin_home'|trans({},'FOSUserBundle') }}</a>
            </li>
            <li class="">
                {{ 'backend.user_menu.administrator.users.title'|trans({},'FOSUserBundle') }}
            </li>
            <li class="active">
                <strong>{{ 'backend.user_menu.administrator.users.add'|trans({},'FOSUserBundle') }}</strong>
            </li>
        </ol>
    </div>
{% endblock %}
{% block body %}
    <div class="ibox">
        <div class="ibox-title">
            <h5>
                <small></small>
            </h5>
        </div>
        <div class="ibox-content">
            {{ form_start(form,{'attr':{
                'id':form.vars.id,
                'novalidate':'novalidate'
            }}) }}

            {{ form_widget(form._token) }}

            {% if form_errors(form) %}

                <div class="alert alert-danger" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                    <span class="fa fa-exclamation"
                          aria-hidden="true"></span>
                    <span class="sr-only">Error:</span>
                    {{ form_errors(form) | striptags }}
                </div>
            {% endif %}


            <div class="row">


                <div class="col-md-4">
                    <div class="animated fadeInLeft col-sm-12 b-r">

                        <div class="">
                            <div id="crop-avatar{{ form.filePath.vars.id }}" class="data-crop"
                                 data-id="{{ form.filePath.vars.id }}">
                                {{ form_widget(form.filePath,{'attr':{'class':'avatar-result hide'} }) }}
                                <!-- Current avatar -->
                                <div class="avatar-view {% if form_errors(form.filePath) %} has-error control-upload{% endif %}"
                                     title="{{ 'backend.tabs_traduccion.change_photo'|trans({},'AppBundle') }}">

                                    {% set foto = asset('assets/backend/img/no-logo4.jpg') %}
                                    {% if form.vars.value !=null and form.filePath.vars.value!='' %}
                                        {% set foto = asset(form.filePath.vars.value) %}
                                    {% endif %}
                                    {#<img style="width: 40%;" class="img-responsive" alt="" src={{ asset(foto) }}>#}
                                    <img src="{{ foto }}" alt="Foto">
                                </div>
                                {% if form_errors(form.filePath) %}
                                    <div class="alert alert-danger" role="alert">
                                        <button type="button" class="close" data-dismiss="alert"
                                                aria-hidden="true">&times;
                                        </button>
                                        <span class="fa fa-exclamation"
                                              aria-hidden="true"></span>
                                        <span class="sr-only">Error:</span>
                                        {{ form_errors(form.filePath) | striptags }}
                                    </div>
                                {% endif %}
                                <!-- Cropping modal -->
                                <div class="modal fade " id="avatar-modal-{{ form.filePath.vars.id }}"
                                     aria-hidden="true"
                                     aria-labelledby="avatar-modal-label"
                                     role="dialog" tabindex="-1">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button class="close" data-dismiss="modal"
                                                        type="button">&times;
                                                </button>
                                                <h4 class="modal-title"
                                                    id="avatar-modal-label">{{ 'backend.tabs_traduccion.change_photo'|trans({},'AppBundle') }}</h4>
                                            </div>
                                            <div class="modal-body">
                                                <div class="avatar-body">
                                                    <form></form>
                                                    <form class="avatar-form avatar-form-{{ form.filePath.vars.id }}"
                                                          action="{{ url('app_photo_crop',{'avatar':true}) }}"
                                                          enctype="multipart/form-data" method="post">

                                                        <!-- Upload image and data -->
                                                        <div class="avatar-upload" style="margin-bottom: -30px;">
                                                            <input class="avatar-src" name="avatar_src" type="hidden">
                                                            <input class="avatar-data" name="avatar_data" type="hidden">

                                                            <div class="input">
                                                                <input class="avatar-input"
                                                                       style="background-color: rgb(171, 0, 88); border-radius: 5px; cursor: pointer; height: 30px; margin-left: 15px; padding-top: 40px; width: 180.5px;"
                                                                       accept="image/*"
                                                                       id="avatarInput{{ form.filePath.vars.id }}"
                                                                       name="avatar_file" type="file">

                                                                <label for="avatarInput{{ form.filePath.vars.id }}"
                                                                       style="width:180.5px;color: white;margin-left: 30px;cursor: pointer; position: relative;top: -30px;">{{ 'backend.tabs_traduccion.select_photo'|trans({},'AppBundle') }}</label>


                                                            </div>
                                                        </div>

                                                        <!-- Crop and preview -->
                                                        <div class="row">
                                                            <div class="col-md-9">
                                                                <div class="avatar-wrapper"></div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <div class="avatar-preview preview-lg"></div>
                                                                <div class="avatar-preview preview-md"
                                                                     style="border-radius: 50%;"></div>
                                                                <div class="avatar-preview preview-sm"></div>
                                                            </div>
                                                        </div>
                                                        <div class="row avatar-btns">
                                                            <div class="col-md-10">
                                                                <div class="btn-group">
                                                                    <button type="button" class="btn btn-primary"
                                                                            data-method="rotate"
                                                                            data-option="-90"
                                                                            title="Rotate -90 degrees">{{ 'backend.tabs_traduccion.rotate_photo_left'|trans({},'AppBundle') }}</button>
                                                                    <button type="button" class="btn btn-primary"
                                                                            data-method="rotate"
                                                                            data-option="-15">-15deg
                                                                    </button>
                                                                    <button type="button" class="btn btn-primary"
                                                                            data-method="rotate"
                                                                            data-option="-30">-30deg
                                                                    </button>
                                                                    <button type="button" class="btn btn-primary"
                                                                            data-method="rotate"
                                                                            data-option="-45">-45deg
                                                                    </button>
                                                                </div>
                                                                <div class="btn-group">
                                                                    <button type="button" class="btn btn-primary"
                                                                            data-method="rotate"
                                                                            data-option="90"
                                                                            title="Rotate 90 degrees">{{ 'backend.tabs_traduccion.rotate_photo_right'|trans({},'AppBundle') }}</button>
                                                                    <button type="button" class="btn btn-primary"
                                                                            data-method="rotate"
                                                                            data-option="15">15deg
                                                                    </button>
                                                                    <button type="button" class="btn btn-primary"
                                                                            data-method="rotate"
                                                                            data-option="30">30deg
                                                                    </button>
                                                                    <button type="button" class="btn btn-primary"
                                                                            data-method="rotate"
                                                                            data-option="45">45deg
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <button class="btn btn-primary btn-block avatar-save"
                                                                        type="submit">
                                                                    <i class="fa fa-save"></i> {{ 'backend.tabs_traduccion.accept'|trans({},'AppBundle') }}
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <!-- /.modal -->


                                <div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>

                            </div>
                        </div>


                    </div>
                </div>
                <div class="col-md-8 form-group pull-right  pull-right required">
                    <div class="">
                        <label class="col-lg-3 control-label text-right">{{ form_label(form.username)|striptags }}
                            <sup>*</sup></label>

                        <div class="col-lg-9">
                            {{ form_widget(form.username,{'attr':{'class':'form-control'}}) }}
                            {% if form_errors(form.username) %}
                                <div class="alert alert-danger" role="alert">
                                    <button type="button" class="close" data-dismiss="alert"
                                            aria-hidden="true">&times;
                                    </button>
                                    <span class="fa fa-exclamation"
                                          aria-hidden="true"></span>
                                    <span class="sr-only">Error:</span>
                                    {{ form_errors(form.username) | striptags }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-8 form-group pull-right  required">
                    <div class="">
                        <label class="col-lg-3 control-label text-right">{{ form_label(form.email)|striptags }}
                            <sup>*</sup></label>

                        <div class="col-lg-9">
                            {{ form_widget(form.email,{'attr':{'class':'form-control'}}) }}
                            {% if form_errors(form.email) %}
                                <div class="alert alert-danger" role="alert">
                                    <button type="button" class="close" data-dismiss="alert"
                                            aria-hidden="true">&times;
                                    </button>
                                    <span class="fa fa-exclamation"
                                          aria-hidden="true"></span>
                                    <span class="sr-only">Error:</span>
                                    {{ form_errors(form.email) | striptags }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% if app.user and is_granted("ROLE_SUPER_ADMIN") %}
                    <div class="col-md-8 form-group pull-right  required">
                        <div class="">
                            <label class="col-lg-3 control-label text-right">{{ form_label(form.user_roles)|striptags }}
                                <sup>*</sup></label>

                            <div class="col-lg-9">
                                {{ form_widget(form.user_roles,{'attr':{'class':'chosen-select'}}) }}
                                {% if form_errors(form.user_roles) %}
                                    <div class="alert alert-danger" role="alert">
                                        <button type="button" class="close" data-dismiss="alert"
                                                aria-hidden="true">&times;
                                        </button>
                                        <span class="fa fa-exclamation"
                                              aria-hidden="true"></span>
                                        <span class="sr-only">Error:</span>
                                        {{ form_errors(form.user_roles) | striptags }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8 form-group pull-right  required">
                        <div class="">
                            <label class="col-lg-3 control-label text-right">{{ form_label(form.agencia)|striptags }}</label>

                            <div class="col-lg-9">
                                {{ form_widget(form.agencia,{'attr':{'class':'chosen-select'}}) }}
                                {% if form_errors(form.agencia) %}
                                    <div class="alert alert-danger" role="alert">
                                        <button type="button" class="close" data-dismiss="alert"
                                                aria-hidden="true">&times;
                                        </button>
                                        <span class="fa fa-exclamation"
                                              aria-hidden="true"></span>
                                        <span class="sr-only">Error:</span>
                                        {{ form_errors(form.agencia) | striptags }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8 form-group pull-right  required">
                        <div class="">
                            <label class="col-lg-3 control-label text-right">{{ form_label(form.agente)|striptags }}</label>

                            <div class="col-lg-9">
                                {{ form_widget(form.agente,{'attr':{'class':'chosen-select'}}) }}
                                {% if form_errors(form.agente) %}
                                    <div class="alert alert-danger" role="alert">
                                        <button type="button" class="close" data-dismiss="alert"
                                                aria-hidden="true">&times;
                                        </button>
                                        <span class="fa fa-exclamation"
                                              aria-hidden="true"></span>
                                        <span class="sr-only">Error:</span>
                                        {{ form_errors(form.agente) | striptags }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8 form-group pull-right  required">
                        <div class="">
                            <label class="col-lg-3 control-label text-right">{{ form_label(form.distribuidor)|striptags }}</label>

                            <div class="col-lg-9">
                                {{ form_widget(form.distribuidor,{'attr':{'class':'chosen-select'}}) }}
                                {% if form_errors(form.distribuidor) %}
                                    <div class="alert alert-danger" role="alert">
                                        <button type="button" class="close" data-dismiss="alert"
                                                aria-hidden="true">&times;
                                        </button>
                                        <span class="fa fa-exclamation"
                                              aria-hidden="true"></span>
                                        <span class="sr-only">Error:</span>
                                        {{ form_errors(form.distribuidor) | striptags }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="col-md-8 form-group pull-right  required">
                        <div class="">
                            <label class="col-lg-3 control-label text-right">{{ form_label(form.agente)|striptags }}
                                <sup>*</sup></label>

                            <div class="col-lg-9">
                                {{ form_widget(form.agente,{'attr':{'class':'chosen-select'}}) }}
                                {% if form_errors(form.agente) %}
                                    <div class="alert alert-danger" role="alert">
                                        <button type="button" class="close" data-dismiss="alert"
                                                aria-hidden="true">&times;
                                        </button>
                                        <span class="fa fa-exclamation"
                                              aria-hidden="true"></span>
                                        <span class="sr-only">Error:</span>
                                        {{ form_errors(form.agente) | striptags }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                <div class="col-md-8 form-group pull-right  required">
                    <div>
                        <label class="col-lg-3 control-label text-right">{{ form_label(form.plainPassword.first) | striptags }}
                            <sup>*</sup></label>
                        <div class="col-lg-9">
                            {{ form_widget(form.plainPassword.first, { 'attr': {'class': 'form-control'} }) }}
                            {% if form_errors(form.plainPassword.first) %}
                                <div class="alert alert-danger" role="alert">
                                    <button type="button" class="close" data-dismiss="alert"
                                            aria-hidden="true">&times;
                                    </button>
                                    <span class="fa fa-exclamation"
                                          aria-hidden="true"></span>
                                    <span class="sr-only">Error:</span>
                                    {{ form_errors(form.plainPassword.first) | striptags }}
                                </div>
                            {% endif %}

                        </div>
                    </div>
                </div>
                <div class="col-md-8 form-group pull-right  required">
                    <label class="col-lg-3 control-label text-right">{{ form_label(form.plainPassword.second) | striptags }}
                        <sup>*</sup></label>
                    <div class="col-lg-9">
                        {{ form_widget(form.plainPassword.second, { 'attr': {'class': 'form-control'} }) }}
                        {% if form_errors(form.plainPassword.second) %}
                            <div class="alert alert-danger" role="alert">
                                <button type="button" class="close" data-dismiss="alert"
                                        aria-hidden="true">&times;
                                </button>
                                <span class="fa fa-exclamation"
                                      aria-hidden="true"></span>
                                <span class="sr-only">Error:</span>
                                {{ form_errors(form.plainPassword.second) | striptags }}
                            </div>
                        {% endif %}

                    </div>
                </div>

                <div class="col-xs-12 text-right">
                    <div class="hr-line-dashed"></div>
                    <p class="font-bold">

                    </p>
                    <a class="btn btn-warning pull-left" href="{{ path('home_users_index') }}"
                       style="margin-left: 5px;"><i
                                class="fa fa-mail-reply"></i> {{ 'backend.comun.form.to_list'|trans }}</a>
                    <button id="save-user" class="btn btn-primary pull-right" type="submit"><i
                                class="fa fa-save"></i> {{ 'backend.comun.table.save'|trans }}</button>

                </div>
            </div>
            {{ form_end(form) }}

        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}

    <script src="{{ asset('assets/backend/js/plugins/cropper/cropper.js') }}"></script>
    <script src="{{ asset('assets/backend/js/plugins/cropper/jquery-cropper.js') }}"></script>
    <script type="application/javascript"
            src="{{ asset('assets/backend/js/plugins/cropper/crop-avatar/js/main.js') }}"></script>
    <script>
        $(function () {
            $('#save-user').click(function (ev) {
                $("#{{ form.vars.id }}").validate({
                    rules: {
                        '{{ form.username.vars.full_name }}': {
                            required: true
                        },
                        '{{ form.email.vars.full_name }}': {
                            required: true,
                            email: true
                        },
                        '{{ form.plainPassword.first.vars.full_name }}': {
                            required: true
                        },
                        '{{ form.plainPassword.second.vars.full_name }}': {
                            required: true
                        },
                    }
                });
            });

            new $.fn.CropAvatar($('#crop-avatar{{ form.filePath.vars.id }}'), 1);
        });

    </script>
{% endblock %}